@page "/demosandbox"
@inject Microsoft.CST.OAT.Blazor.AppState AppState;

<button @onclick="RefreshState">Re-Run Rules</button>
<br />
<button @onclick="AddObject">Add Vehicle</button>
<button @onclick="RemoveLastObject">Remove Last Vehicle</button>
<br />
@for (int i = 0; i < AppState.DemoTestObjects.Count; i++)
{
    var results = analyzer.Analyze(AppState.DemoRules, AppState.DemoTestObjects[i]);
    <span>@results.Count() rules applied.</span>
    <br />
    foreach (var result in results)
    {
        <b>@result.Name</b>
        <br />
    }
    <ObjectInput id="@i.ToString()" Object="@AppState.DemoTestObjects[i]" />

}
@code {
    Analyzer analyzer = new Analyzer(new AnalyzerOptions(true));

    protected override void OnInitialized()
    {
        var results = analyzer.Analyze(AppState.Rules);
        base.OnInitialized();
    }

    void RefreshState()
    {
        this.StateHasChanged();
    }

    void RemoveLastObject()
    {
        AppState.DemoTestObjects.RemoveAt(AppState.DemoTestObjects.Count - 1);
    }

    void AddObject()
    {
        AppState.DemoTestObjects.Add(new Microsoft.CST.OAT.VehicleDemo.Vehicle());
    }
}
